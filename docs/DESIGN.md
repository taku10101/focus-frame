# FocusFrame 設計書

## 概要

25分間の集中セッション（ポモドーロ）を達成するたびにドット絵のマスが1つ開放され、著作権切れの名画が徐々にリビールされるPWA。

**コンセプト:** 集中するほど、名画が見えてくる。

---

## ターゲットユーザー

### プライマリ
- **学生・社会人（20〜35歳）**: 集中力を高めたいが、既存のポモドーロアプリに飽きている
- **クリエイティブワーカー**: デザイナー、エンジニア、ライターなど、長時間集中が必要な職種
- **アート好き**: 名画に興味があり、コレクション要素に惹かれる層

### セカンダリ
- **資格勉強中の社会人**: 勉強のモチベーション維持ツールとして
- **リモートワーカー**: 自宅での集中管理に課題を感じている層

### ペルソナ

**ペルソナA: タクミ（27歳・エンジニア）**
- ポモドーロテクニックは知っているが続かない
- 「ご褒美」がないとモチベーションが維持できない
- ゲーム的な達成要素があると続けられるタイプ
- 名画は詳しくないが、ドット絵が徐々に見えていく体験に興味

**ペルソナB: ユイ（23歳・大学院生）**
- 論文執筆で毎日長時間の集中が必要
- SNSに集中の成果をシェアしたい
- アートが好きで、コレクションを増やすことに喜びを感じる
- 「今日は何の絵だろう？」というワクワク感が集中の動機に

---

## ユーザーストーリー

### P0（MVP必須）
| ID | ストーリー | 受け入れ基準 |
|----|-----------|-------------|
| US-01 | ユーザーとして、25分のポモドーロタイマーを開始したい | 開始・一時停止・リセットができる。完了時に通知 |
| US-02 | ユーザーとして、セッション完了時にドット絵のマスが1つ開放されるのを見たい | ランダムな未開放マスが色付きで表示される |
| US-03 | ユーザーとして、作者/ジャンル/時代から絵を選びたい（作品名は非公開） | フィルタ選択→ランダム割り当て。タイトルは完成まで非表示 |
| US-04 | ユーザーとして、全マス開放時に作品名がリビールされたい | 完成アニメーション + タイトル表示 |
| US-05 | ユーザーとして、進捗がブラウザを閉じても保存されていてほしい | IndexedDBに永続化 |
| US-06 | ユーザーとして、PWAとしてインストールしたい | manifest.json + Service Worker |

### P1（v0.2）
| ID | ストーリー | 受け入れ基準 |
|----|-----------|-------------|
| US-07 | ユーザーとして、マス数を選びたい（5×5, 8×8, 10×10, N×N） | プリセット + カスタム入力 |
| US-08 | ユーザーとして、タイマー時間をカスタムしたい | 設定画面から変更可能 |
| US-09 | ユーザーとして、完成した作品のコレクションを見たい | 一覧 + 詳細画面 |
| US-10 | ユーザーとして、途中経過や完成をSNSにシェアしたい | OGP画像生成 + シェアボタン |

### P2（将来）
| ID | ストーリー | 受け入れ基準 |
|----|-----------|-------------|
| US-11 | ユーザーとして、パレットテーマ（ファミコン風等）を選びたい | 色数制限オプション |
| US-12 | ユーザーとして、集中統計を見たい | 日別/週別/月別の集中時間グラフ |
| US-13 | ユーザーとして、開放順を選びたい（ランダム/端から中心等） | 開放パターン選択 |

---

## コア機能

### 1. ポモドーロタイマー
- 25分集中 → 5分休憩（デフォルト）
- タイマー時間はカスタム可能
- バックグラウンド動作（Service Worker / Notification API）
- 開始・一時停止・リセット

### 2. ドット絵リビール
- 集中セッション完了ごとにマスが1つランダムに開放
- 未開放マスはグレー or ぼかし表示
- 全マス開放で作品名がリビール🎉

### 3. 絵の選択
- **作品名は非公開**（完成まで何の絵かわからない）
- 選択軸:
  - **作者**: ゴッホ、北斎、モネ、フェルメール、クリムト…
  - **ジャンル**: 風景、人物、静物、浮世絵、抽象
  - **時代**: ルネサンス、印象派、近代日本
- 組み合わせフィルタ対応
- 条件に合う作品からランダムで1枚割り当て

### 4. マス数設定
- プリセット: 5×5 (25) / 8×8 (64) / 10×10 (100)
- カスタム N×N 対応
- マス数が少ない → シルエット系の絵が映える
- マス数が多い → 細密な絵も表現可能

### 5. コレクション
- 完成した絵の一覧表示
- 作品名・作者・完成日・かかったセッション数
- SNSシェア機能（途中経過 / 完成時）

---

## 画面構成

```
┌─────────────────────────────┐
│  [設定]           [コレクション]  │
│                               │
│      ┌───────────────┐       │
│      │               │       │
│      │   ドット絵     │       │
│      │   リビール     │       │
│      │   エリア       │       │
│      │               │       │
│      └───────────────┘       │
│                               │
│         25:00                 │
│      [ スタート ]             │
│                               │
│   進捗: 15/64マス開放         │
│   作者: ゴッホ │ ジャンル: 風景  │
└─────────────────────────────┘
```

### 画面一覧
1. **ホーム** — タイマー + リビールエリア（メイン画面）
2. **絵の選択** — 作者/ジャンル/時代フィルタ + マス数設定
3. **コレクション** — 完成作品一覧
4. **作品詳細** — 完成した絵の拡大表示 + 情報
5. **設定** — タイマー時間、通知、テーマ

---

## 技術スタック

| 項目 | 技術 |
|------|------|
| フレームワーク | Next.js (App Router) |
| 言語 | TypeScript |
| スタイル | Tailwind CSS |
| ドット絵変換 | Canvas API |
| データ保存 | IndexedDB (Dexie.js) |
| タイマー | Web Worker |
| 通知 | Notification API |
| PWA | next-pwa / Service Worker |
| デプロイ | Vercel |
| 画像ソース | Wikimedia Commons (パブリックドメイン) |

### 月額コスト: ¥0
- Vercel無料枠
- 画像はビルド時にバンドル or CDN
- サーバーサイド処理なし

---

## 非機能要件

| カテゴリ | 要件 | 目標値 |
|---------|------|--------|
| パフォーマンス | 初回ロード (LCP) | < 2.5秒 |
| パフォーマンス | ドット絵変換処理 | < 500ms（10×10まで） |
| パフォーマンス | Lighthouse Performance | ≥ 90 |
| オフライン | PWAオフライン動作 | タイマー + 進行中の絵は完全オフライン可 |
| データ | ローカルデータ永続性 | IndexedDB。ブラウザクリアまで保持 |
| アクセシビリティ | WCAG 2.1 AA準拠 | 色覚多様性対応、キーボード操作可 |
| セキュリティ | 外部通信 | 画像取得以外のサーバー通信なし |
| 対応ブラウザ | モダンブラウザ | Chrome, Safari, Firefox, Edge 最新2バージョン |
| 対応デバイス | レスポンシブ | モバイルファースト。375px〜1440px |

---

## ドット絵変換ロジック

```typescript
function pixelateImage(
  image: HTMLImageElement,
  gridSize: number
): PixelData[][] {
  const canvas = document.createElement('canvas')
  canvas.width = gridSize
  canvas.height = gridSize
  const ctx = canvas.getContext('2d')!

  // 元画像をN×Nにリサイズ描画（ブラウザが補間）
  ctx.drawImage(image, 0, 0, gridSize, gridSize)

  // 各マスの色を取得
  const grid: PixelData[][] = []
  for (let y = 0; y < gridSize; y++) {
    const row: PixelData[] = []
    for (let x = 0; x < gridSize; x++) {
      const [r, g, b] = ctx.getImageData(x, y, 1, 1).data
      row.push({ r, g, b, revealed: false })
    }
    grid.push(row)
  }
  return grid
}
```

### パレット制限（オプション）
- 16色/32色パレットに最近傍色で丸めるとドット絵感UP
- ファミコン風、ゲームボーイ風などテーマパレットも面白い

---

## データモデル

```typescript
// 作品マスター
interface Artwork {
  id: string
  artist: string          // "ゴッホ"
  genre: string[]         // ["風景", "印象派"]
  era: string             // "印象派"
  title: string           // "星月夜"（完成まで非表示）
  imagePath: string       // 元画像パス
  minGrid: number         // 推奨最小マス数
}

// 進行中のチャレンジ
interface Challenge {
  id: string
  artworkId: string
  gridSize: number        // ユーザー設定のマス数
  pixelGrid: PixelData[][]
  revealedCount: number
  totalCells: number
  startedAt: Date
  completedAt?: Date
  sessionCount: number    // 実施したポモドーロ数
}

// セッション履歴
interface Session {
  id: string
  challengeId: string
  startedAt: Date
  completedAt: Date
  duration: number        // 秒
  cellRevealed: { x: number; y: number }
}

// コレクション（完成済み）
interface Collection {
  challengeId: string
  artwork: Artwork
  gridSize: number
  completedAt: Date
  totalSessions: number
  totalMinutes: number
}
```

---

## 作品データ（初期収録案）

### マス数別おすすめ

#### 5×5向き（シルエット・高コントラスト）
| 作者 | ジャンル | 特徴 |
|------|---------|------|
| ムンク | 人物 | 強烈なシルエット |
| 北斎 | 浮世絵 | 波の形が認識しやすい |
| マレーヴィチ | 抽象 | 幾何学形状 |

#### 8×8向き（特徴的な構図）
| 作者 | ジャンル | 特徴 |
|------|---------|------|
| ゴッホ | 風景 | 渦巻き・色彩が特徴的 |
| フェルメール | 人物 | 青ターバンのコントラスト |
| 歌川広重 | 浮世絵 | 構図が明快 |

#### 10×10向き（細密・グラデーション）
| 作者 | ジャンル | 特徴 |
|------|---------|------|
| ダ・ヴィンチ | 人物 | 表情の繊細さ |
| モネ | 風景 | 色彩グラデーション |
| クリムト | 人物 | 金色パターン |

---

## マス開放ロジック

```typescript
function revealNextCell(challenge: Challenge): { x: number; y: number } {
  // 未開放マスからランダムに1つ選択
  const unrevealed: { x: number; y: number }[] = []
  for (let y = 0; y < challenge.gridSize; y++) {
    for (let x = 0; x < challenge.gridSize; x++) {
      if (!challenge.pixelGrid[y][x].revealed) {
        unrevealed.push({ x, y })
      }
    }
  }
  const idx = Math.floor(Math.random() * unrevealed.length)
  const cell = unrevealed[idx]
  challenge.pixelGrid[cell.y][cell.x].revealed = true
  challenge.revealedCount++
  return cell
}
```

### 開放順の工夫（将来）
- 完全ランダム（デフォルト）
- 端から中心へ（ドラマチック）
- 特徴的な部分を後半に（サプライズ感UP）

---

## KPI・成功指標

| 指標 | 目標（リリース後3ヶ月） | 計測方法 |
|------|----------------------|---------|
| MAU（月間アクティブユーザー） | 500+ | アナリティクス（将来導入） |
| 平均セッション数/ユーザー/日 | 3+ | IndexedDBデータ（ローカル統計） |
| 作品完成率 | 40%以上（開始した作品のうち） | ローカル統計 |
| PWAインストール率 | 訪問者の20%以上 | beforeinstallpromptイベント |
| 1週間リテンション率 | 30%以上 | 再訪問率（アナリティクス） |

### North Star Metric
**週あたりの完成作品数（全ユーザー合計）** — 集中の習慣化とアプリの価値提供を同時に測れる

---

## リスクと対策

| リスク | 影響 | 確率 | 対策 |
|--------|------|------|------|
| Canvas APIのブラウザ互換性 | ドット絵描画が一部端末で動かない | 低 | Canvas 2Dは広くサポート済み。polyfill不要。Safari/iOS早期テスト |
| ドット絵の解像度不足 | 5×5等の低解像度で絵が認識できない | 中 | 作品ごとに推奨最小マス数(minGrid)を設定。シルエット系を低解像度向けに |
| 画像の著作権 | パブリックドメインでない画像の混入 | 低 | Wikimedia Commons PD-Art のみ使用。出典をメタデータに記録 |
| IndexedDBの容量制限 | 作品画像データが大きすぎる | 中 | 画像はビルド時バンドル。IndexedDBには進捗データのみ保存 |
| PWAオフライン時の画像取得 | 新しい絵を選択できない | 中 | Service Workerで作品画像をプリキャッシュ |
| モチベーション低下 | マス数が多すぎて完成前に離脱 | 高 | デフォルト8×8（64セッション）。5×5で手軽なオプションも提供 |
| 類似アプリとの差別化 | Forest等の集中アプリとの競合 | 中 | 「名画ドット絵リビール」のユニーク体験で差別化。無料・オフラインを強調 |

---

## MVPスプリント計画

### Sprint 1（Week 1-2）: 基盤 + タイマー
- [ ] Next.js + TypeScript + Tailwind プロジェクトセットアップ
- [ ] PWA設定（manifest.json, Service Worker）
- [ ] ポモドーロタイマー実装（Web Worker）
- [ ] 基本UIレイアウト（モバイルファースト）

### Sprint 2（Week 3-4）: ドット絵リビール
- [ ] Canvas APIでドット絵変換ロジック実装
- [ ] マス開放アニメーション
- [ ] リビール完了時の演出（タイトル表示）
- [ ] 作品データ3〜5点の準備（Wikimedia Commonsから取得）

### Sprint 3（Week 5-6）: データ永続化 + 選択
- [ ] IndexedDB (Dexie.js) セットアップ
- [ ] チャレンジ進捗の保存・復元
- [ ] 作者/ジャンル/時代フィルタによる絵の選択画面
- [ ] コレクション画面（完成作品一覧）

### Sprint 4（Week 7-8）: 仕上げ + デプロイ
- [ ] UIデザイン仕上げ（アニメーション、トランジション）
- [ ] Lighthouse最適化（Performance ≥ 90）
- [ ] Vercelデプロイ + OGP設定
- [ ] README + ドキュメント整備

---

## MVP スコープ（v0.1）

### 含む
- [x] ポモドーロタイマー（25分固定）
- [x] ドット絵リビール（8×8固定）
- [x] 作品3〜5点（ハードコード）
- [x] 作者/ジャンルで選択
- [x] IndexedDBで進捗保存
- [x] PWA対応

### 含まない（v0.2以降）
- [ ] マス数カスタム
- [ ] タイマー時間カスタム
- [ ] パレット制限テーマ
- [ ] SNSシェア
- [ ] 開放順のバリエーション
- [ ] 作品追加（50点→100点）
- [ ] 統計ダッシュボード

---

## 意思決定ログ

| 日付 | 決定事項 | 理由 | 代替案 |
|------|---------|------|--------|
| 2025-02-22 | ジェネラティブアート → ドット絵リビールに変更 | 「集中のご褒美」としてランダム生成よりも名画リビールの方がコレクション性・ワクワク感が高い。著作権切れ作品なら権利問題もクリア | p5.jsジェネラティブアート |
| 2025-02-22 | p5.js → Canvas API | ドット絵変換のみなのでCanvas 2D APIで十分。バンドルサイズ削減 | p5.js（オーバースペック） |
| 2025-02-22 | 作品名を非公開にする | 「何の絵だろう？」という期待感が集中のモチベーションになる | 最初からタイトル表示（ワクワク感が減る） |
| 2025-02-22 | マス数をユーザー設定可能にする | 5×5（25セッション）〜カスタムN×Nで難易度調整。ライトユーザーもヘビーユーザーも満足 | 固定マス数（柔軟性不足） |
| 2025-02-22 | Dexie.js採用 | IndexedDB直接操作は複雑。Dexie.jsでPromiseベースの簡潔なAPI | localStorage（容量制限5MB）、raw IndexedDB（DX悪い） |
| 2025-02-22 | Biome採用（ESLint/Prettierではなく） | Rust製で高速。lint + format統合。設定がシンプル | ESLint + Prettier（設定が煩雑） |
