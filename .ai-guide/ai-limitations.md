# AI利用時の制約と注意事項

このドキュメントでは、 AI ツール（Claude Code、GitHub Copilot など）を使用する際の制約事項と注意点を定義します。

## セキュリティとプライバシー

### 絶対に AI に入力してはいけない情報

- **本番環境の認証情報**: パスワード、APIキー、アクセストークン、秘密鍵
- **個人情報（PII）**: 実際の顧客データ、従業員の個人情報、メールアドレス
- **機密データ**: 未公開の事業計画、財務情報、契約内容
- **本番データベースの接続情報**: 接続文字列、ホスト名、ポート番号
- **内部ネットワーク情報**: 内部IPアドレス、VPN設定、ファイアウォール規則

### セキュリティ関連コードのレビュー

- **認証・認可処理**: AI生成コードは必ず人間がセキュリティレビュー
- **暗号化処理**: 暗号化アルゴリズムや実装の適切性を専門家が確認
- **入力検証**: XSS、SQLインジェクション対策コードは徹底的にレビュー
- **CSRF対策**: トークン生成・検証ロジックは人間が検証
- **セッション管理**: セッション固定化攻撃対策などを確認

## コード生成の制限事項

### AI が苦手とする領域

- **複雑なビジネスロジック**: 権限モデルなど固有のロジック
- **パフォーマンス最適化**: 大規模データ処理やクエリ最適化は実測が必要
- **レガシーコード統合**: Closure CompilerとReactの混在環境での適切な実装
- **マルチテナント処理**: テナント分離やデータアイソレーションの実装
- **トランザクション管理**: 分散トランザクションや複雑なロールバック処理

### バージョン依存の注意点

- **React 16**: 最新のReact機能との混同に注意（React 16 を使用）
- **依存ライブラリ**: package.jsonやbuild.gradle.ktsの実際のバージョンを優先

## テストコード生成の注意点

### 不適切なテストパターン

- **実装詳細のテスト**: privateメソッドの直接テストは避ける
- **モック過多**: 過度なモック使用は統合テストで補完
- **非決定的テスト**: 日時や乱数に依存するテストは固定値を使用
- **環境依存テスト**: ファイルシステムやネットワークに依存するテストは注意

### テストデータの扱い

- **本番データの使用禁止**: テストには必ずモックデータを使用
- **個人情報の生成**: ダミーデータジェネレーターを使用
- **マルチテナントテスト**: テナント間のデータ漏洩をテストで確認

## データベース操作の制約

### マイグレーションスクリプト

- **破壊的変更**: AI生成のDDLは必ずロールバック可能性を確認
- **大量データ更新**: バッチ処理やインデックス作成は性能影響を評価
- **外部キー制約**: カスケード削除の影響範囲を慎重に検討

### クエリ最適化

- **実行計画の確認**: AI生成のクエリは必ずEXPLAINで確認
- **インデックス設計**: 複合インデックスの順序は業務要件に基づいて決定
- **N+1問題**: ORMを使用する際のクエリ発行回数に注意

## フロントエンド開発の注意点

### レガシーコードとの共存

- **Closure Compiler準拠**: Duck ビルドシステムの制約を理解した上で実装
- **グローバル変数**: レガシーコードとの名前空間衝突に注意
- **イベントハンドリング**: 新旧システム間のイベント伝播を考慮

### パフォーマンス考慮事項

- **バンドルサイズ**: AI提案のライブラリ追加は影響を評価
- **レンダリング最適化**: React.memoやuseMemoの過度な使用を避ける
- **非同期処理**: Promise やasync/awaitの適切なエラーハンドリング

## 法的・コンプライアンス関連

### ライセンス管理

- **OSSライセンス**: AI提案のライブラリのライセンス互換性を確認
- **コピーライト**: AI生成コードの著作権表記は組織のポリシーに従う
- **特許関連**: アルゴリズムの特許侵害リスクを考慮

### 規制対応

- **GDPR/個人情報保護法**: データ処理ロジックは法務確認が必要
- **アクセシビリティ**: WCAG準拠は手動でも確認
- **輸出規制**: 暗号化技術の使用は規制を確認

## AI ツール固有の制限

### Claude Code

- **コンテキスト長制限**: 大規模ファイルは分割して処理
- **実行環境**: 本番環境での直接実行は禁止
- **ファイル編集**: 重要なファイルは必ずバックアップ

### GitHub Copilot

- **コード漏洩リスク**: パブリックリポジトリのコードが提案される可能性
- **ライセンス汚染**: 提案コードのライセンスが不明確な場合がある

## レビューとテストの必須事項

### 必ず人間が確認すべき項目

1. **セキュリティ**: 認証、認可、暗号化、入力検証
2. **パフォーマンス**: クエリ実行計画、メモリ使用量、応答時間
3. **エラーハンドリング**: 例外処理、ロールバック、リトライロジック
4. **ログ出力**: 機密情報の漏洩、適切なログレベル
5. **国際化**: 文字エンコーディング、タイムゾーン処理
6. **互換性**: 既存APIとの後方互換性、ブラウザ互換性

### テスト必須項目

- **境界値テスト**: 最大値、最小値、NULL、空文字列
- **異常系テスト**: タイムアウト、接続エラー、権限エラー
- **並行処理テスト**: 競合状態、デッドロック
- **セキュリティテスト**: ペネトレーションテスト、脆弱性スキャン

## まとめ

AI ツールは開発生産性を向上させる強力なツールですが、以下の原則を守ることが重要です：

1. **Trust but Verify**: AI の提案は参考にしつつ、必ず検証する
2. **Security First**: セキュリティ関連は人間が最終判断
3. **Test Everything**: AI 生成コードも通常コードと同じ品質基準でテスト
4. **Document Decisions**: AI を使用した箇所と判断理由を記録
5. **Continuous Learning**: AI の限界を理解し、適切に活用する
